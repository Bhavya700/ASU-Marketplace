---
// src/components/astro/ListingCard.astro
import type { Database } from '../../types/supabase'; // We will create this type file next

// Define props to expect a single listing object
export interface Props {
    listing: any; // Using 'any' for now, will tighten with generated types
}

const { listing } = Astro.props;

// Safely get the category name from the nested structure
const category = listing.listing_categories[0]?.categories?.name || 'General';

// Format the date
const date = new Date(listing.created_at).toLocaleDateString('en-US', {
    month: 'short', day: 'numeric', year: 'numeric'
});
---
<a href={`/listings/${listing.id}`} class="bg-white rounded-lg shadow-md overflow-hidden flex flex-col hover:shadow-xl transition-shadow duration-300">
    <div class="relative">
        <img src={listing.image_url} alt={`Image of ${listing.title}`} class="w-full h-48 object-cover"/>
        <span class="absolute top-2 right-2 bg-asu-gold text-asu-dark-grey font-bold py-1 px-3 rounded-full text-sm">${listing.price}</span>
    </div>
    <div class="p-4 flex flex-col flex-grow">
        <h3 class="text-lg font-bold mb-1 truncate">{listing.title}</h3>
        <p class="text-sm text-gray-600 mb-4">Quantity: {listing.quantity}</p>
        
        <div class="flex-grow"></div> <!-- Pushes content below it to the bottom -->

        <div class="border-t pt-2 flex justify-between items-center text-xs text-gray-500">
            <span>{date}</span>
            <span class="bg-asu-maroon text-white font-semibold py-1 px-2 rounded">{category}</span>
        </div>
    </div>
</a>